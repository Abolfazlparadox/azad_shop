{% load static %}
{% load thumbnail %}
{% load poll_extras %}



<div class="product-box-3 h-100 wow fadeInUp">
    <div class="product-header">
        <div class="product-image">
            <a href="{{ product.get_absolute_url }}">
                {% if product.main_image %}
                    {% thumbnail product.main_image "600x600" quality=99 crop="center" as im %}
                        <img src="{{ im.url }}" class="img-fluid blur-up lazyload" alt="{{ product.title }}">
                    {% endthumbnail %}
                {% else %}
                    <img src="{% static 'images/appstore.svg' %}" class="img-fluid blur-up lazyload" alt="Default image">
                {% endif %}
            </a>
            <ul class="product-option">
                <li data-bs-toggle="tooltip" data-bs-placement="top" title="نمایش">
                    <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#view">
                        <i data-feather="eye"></i>
                    </a>
                </li>
                <li data-bs-toggle="tooltip" data-bs-placement="top" title="مقایسه">
                    <a href="compare.html">
                        <i data-feather="refresh-cw"></i>
                    </a>
                </li>
                <li data-bs-toggle="tooltip" data-bs-placement="top" title="افزودن به لیست علاقه‌مندی‌ها">
                    <a href="wishlist.html" class="notifi-wishlist">
                        <i data-feather="heart"></i>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="product-footer">
        <div class="product-detail">
            <a href="{{ product.get_absolute_url }}">
                <h5 class="name">{{ product.title }}</h5>
            </a>
            <p class="text-content mt-1 mb-2 product-content">{{ product.short_description }}</p>
            <div class="right-box-contain">
                {% with variant_map=product_variant_map|get_item:product.pk %}
                    <div class="product-package" data-product-id="{{ product.pk }}">
                        {% if variant_map.color_to_sizes and variant_map.color_to_sizes.items %}
                            <div class="product-title">
                                <h4>رنگ</h4>
                            </div>
                            <ul class="color circle select-package color-options" data-product-id="{{ product.pk }}">
                                {% for color, sizes in variant_map.color_to_sizes.items %}
                                    {% if color != "None" %}
                                        <li class="form-check">
                                            <input class="form-check-input color-input" type="radio"
                                                   name="color-{{ product.pk }}"
                                                   id="color-{{ product.pk }}-{{ forloop.counter }}"
                                                   data-color-id="{{ color }}" {% if forloop.first %}checked{% endif %}>
                                            <label class="form-check-label" for="color-{{ product.pk }}-{{ forloop.counter }}">
                                                <span style="background-color: {{ color }}"></span>
                                            </label>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% endif %}
                        {% if variant_map.size_to_colors and variant_map.size_to_colors.items %}
                            <div class="product-title">
                                <h4>سایز</h4>
                            </div>
                            <ul class="circle select-package size-options" id="size-options-{{ product.pk }}">
                                {% for size, colors in variant_map.size_to_colors.items %}
                                    {% if size != "None" %}
                                        <li class="form-check">
                                            <input class="form-check-input" type="radio"
                                                   name="size-{{ product.pk }}"
                                                   id="size-{{ product.pk }}-{{ forloop.counter }}"
                                                   value="{{ size }}" {% if forloop.first %}checked{% endif %}>
                                            <label class="form-check-label" for="size-{{ product.pk }}-{{ forloop.counter }}">
                                                <span>{{ size }}</span>
                                            </label>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    {% with first_variant=variant_map.variants.0 %}
                        <div class="product-footer mt-2">
                            <strong>قیمت:</strong>
                            <h5>
                                <span class="theme-color" id="price-{{ product.pk }}">
                                    {{ first_variant.price|floatformat:0 }} تومان
                                </span>
                            </h5>
                            <h5>
                                <span class="theme-color" id="stock-{{ product.pk }}">
                                    موجودی: {{ first_variant.stock }}
                                </span>
                            </h5>
                            {% if first_variant.discount %}
                                <h6 class="text-danger">تخفیف: {{ first_variant.discount| three_digits_currency }} تومان</h6>
                            {% endif %}
                        </div>
                    {% endwith %}
                {% endwith %}
            </div>
            <div class="product-rating mt-2">
                <ul class="rating">
                    <li><i data-feather="star" class="fill"></i></li>
                    <li><i data-feather="star" class="fill"></i></li>
                    <li><i data-feather="star" class="fill"></i></li>
                    <li><i data-feather="star" class="fill"></i></li>
                    <li><i data-feather="star"></i></li>
                </ul>
                <span>(4.0)</span>
            </div>
            <div class="add-to-cart-box bg-white">
                <button class="btn btn-add-cart addcart-button">افزودن
                    <span class="add-icon bg-light-gray"> <i class="fa-solid fa-plus"></i> </span></button>
                <div class="cart_qty qty-box">
                    <div class="input-group bg-white">
                        <button type="button" class="qty-left-minus bg-gray" data-type="minus" data-field="">
                            <i class="fa fa-minus" aria-hidden="true"></i>
                        </button>
                        <input class="form-control input-number qty-input" type="text" name="quantity" value="0">
                        <button type="button" class="qty-right-plus bg-gray" data-type="plus" data-field="">
                            <i class="fa fa-plus" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{ product_variant_map|json_script:"product-variant-map-data" }}

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function () {
        const productVariantMap = JSON.parse(document.getElementById('product-variant-map-data').textContent);
        console.log(productVariantMap);
        // اگر خواستی اینجا بگم چطوری با انتخاب رنگ یا سایز قیمت آپدیت بشه هم می‌تونم کمک کنم
    });
</script>


{#<div class="product-box-3 h-100 wow fadeInUp">#}
{#    <div class="product-header">#}
{#        <div class="product-image">#}
{#            <a href="{{ product.get_absolute_url }}">#}
{#                {% if product.main_image %}#}
{#                    {% thumbnail product.main_image "600x600" quality=99 crop="center" as im %}#}
{#                        <img src="{{ im.url }}" class="img-fluid blur-up lazyload" alt="{{ product.title }}">#}
{#                    {% endthumbnail %}#}
{#                {% else %}#}
{#                    <img src="{% static 'images/appstore.svg' %}" class="img-fluid blur-up lazyload" alt="Default image">#}
{#                {% endif %}#}
{#            </a>#}
{##}
{#            <ul class="product-option">#}
{#                <!-- آیکون‌ها -->#}
{#                ...#}
{#            </ul>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="product-footer">#}
{#        <div class="product-detail">#}
{#            <a href="{{ product.get_absolute_url }}">#}
{#                <h5 class="name">{{ product.title }}</h5>#}
{#            </a>#}
{#            <p class="text-content mt-1 mb-2 product-content">{{ product.short_description }}</p>#}
{##}
{#            <div class="right-box-contain">#}
{#                {% with variant_map=product_variant_map|get_item:product.pk %}#}
{#                    <div class="product-package" data-product-id="{{ product.pk }}">#}
{##}
{#                        {% if variant_map.color_to_sizes and variant_map.color_to_sizes.items %}#}
{#                            <div class="product-title">#}
{#                                <h4>رنگ</h4>#}
{#                            </div>#}
{#                            <ul class="color circle select-package color-options" data-product-id="{{ product.pk }}">#}
{#                                {% for color, sizes in variant_map.color_to_sizes.items %}#}
{#                                    {% if color != "None" %}#}
{#                                        <li class="form-check">#}
{#                                            <input class="form-check-input color-input"#}
{#                                                   type="radio"#}
{#                                                   name="color-{{ product.pk }}"#}
{#                                                   id="color-{{ product.pk }}-{{ forloop.counter }}"#}
{#                                                   data-color-id="{{ color }}"#}
{#                                                   {% if forloop.first %}checked{% endif %}>#}
{#                                            <label class="form-check-label" for="color-{{ product.pk }}-{{ forloop.counter }}">#}
{#                                                <span style="background-color: {{ color }}"></span>#}
{#                                            </label>#}
{#                                        </li>#}
{#                                    {% endif %}#}
{#                                {% endfor %}#}
{#                            </ul>#}
{#                        {% endif %}#}
{##}
{#                        {% if variant_map.size_to_colors and variant_map.size_to_colors.items %}#}
{#                            <div class="product-title">#}
{#                                <h4>سایز</h4>#}
{#                            </div>#}
{#                            <ul class="circle select-package size-options" id="size-options-{{ product.pk }}">#}
{#                                {% for size, colors in variant_map.size_to_colors.items %}#}
{#                                    {% if size != "None" %}#}
{#                                        <li class="form-check">#}
{#                                            <input class="form-check-input"#}
{#                                                   type="radio"#}
{#                                                   name="size-{{ product.pk }}"#}
{#                                                   id="size-{{ product.pk }}-{{ forloop.counter }}"#}
{#                                                   value="{{ size }}"#}
{#                                                   {% if forloop.first %}checked{% endif %}>#}
{#                                            <label class="form-check-label" for="size-{{ product.pk }}-{{ forloop.counter }}">#}
{#                                                <span>{{ size }}</span>#}
{#                                            </label>#}
{#                                        </li>#}
{#                                    {% endif %}#}
{#                                {% endfor %}#}
{#                            </ul>#}
{#                        {% endif %}#}
{##}
{#                    </div>#}
{##}
{#                    <!-- قیمت و موجودی -->#}
{#                    {% with first_variant=variant_map.variants.0 %}#}
{#                        <div class="product-footer mt-2">#}
{#                            <strong>قیمت:</strong>#}
{#                            <h5>#}
{#                                <span class="theme-color" id="price-{{ product.pk }}">#}
{#                                    {{ first_variant.price|floatformat:0 }} تومان#}
{#                                </span>#}
{#                            </h5>#}
{#                            <h5>#}
{#                                <span class="theme-color" id="stock-{{ product.pk }}">#}
{#                                    موجودی: {{ first_variant.stock }}#}
{#                                </span>#}
{#                            </h5>#}
{#                            {% if first_variant.discount %}#}
{#                                <h6 class="text-danger">تخفیف: {{ first_variant.discount }} تومان</h6>#}
{#                            {% endif %}#}
{#                        </div>#}
{#                    {% endwith %}#}
{#                {% endwith %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
{##}
{#{{ product_variant_map|json_script:"product-variant-map-data" }}#}
{##}
{#<script type="text/javascript">#}
{#    document.addEventListener("DOMContentLoaded", function () {#}
{#        const productVariantMap = JSON.parse(document.getElementById('product-variant-map-data').textContent);#}
{#        console.log(productVariantMap);#}
{#        // اگر خواستی اینجا بگم چطوری با انتخاب رنگ یا سایز قیمت آپدیت بشه هم می‌تونم کمک کنم#}
{#    });#}
{#</script>#}

