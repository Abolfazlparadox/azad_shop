{% load static %}
<li class="{% if comment.parent %}li-padding{% endif %}">
  <div class="user-box {% if not comment.parent %}border-color{% endif %}">
    <!-- reply button as a real button -->
    <button type="button"
            class="reply-button btn btn-link p-0 mb-2"
            data-comment-id="{{ comment.id }}">
      <i class="fa-solid fa-reply"></i>
      <span class="theme-color">پاسخ</span>
    </button>

    <!-- avatar, name, date, content -->
    <div class="user-image">
      {% if comment.user.avatar %}
        <img src="{{ comment.user.avatar.url }}"
             class="img-fluid blur-up lazyload"
             alt="{{ comment.user.get_full_name }}">
      {% else %}
        <img src="{% static 'images/inner-page/user/default-avatar.jpg' %}"
             class="img-fluid blur-up lazyload"
             alt="{{ comment.user.get_full_name }}">
      {% endif %}
      <div class="user-name">
        <h6>{{ comment.created_at|date:"j F Y" }}</h6>
        <h5 class="text-content">{{ comment.user.get_full_name }}</h5>
      </div>
    </div>

    <div class="user-contain">
      <p>{{ comment.content }}</p>
    </div>

    {% if user.is_authenticated %}
      {# Pre‐rendered reply form, hidden by default #}
      <div id="reply-form-{{ comment.id }}" style="display:none; margin-top:1rem;">
        <form method="post" action="{% url 'comment:add_to_blog' post.pk %}">
          {% csrf_token %}
          <input type="hidden" name="parent" value="{{ comment.id }}">
          <div class="mb-2">
            <textarea name="content"
                      class="form-control"
                      rows="3"
                      placeholder="پاسخ شما"
                      required></textarea>
          </div>
          <div class="mb-2">
            <select name="rating" class="form-select" required>
              <option value="">امتیاز</option>
              <option value="1">1 ⭐</option>
              <option value="2">2 ⭐</option>
              <option value="3">3 ⭐</option>
              <option value="4">4 ⭐</option>
              <option value="5">5 ⭐</option>
            </select>
          </div>
          <button type="submit"
                  class="btn btn-sm theme-bg-color text-white">
            ارسال پاسخ
          </button>
        </form>
      </div>
    {% endif %}
  </div>
</li>
